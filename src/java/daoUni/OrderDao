package dao;

public class OrderDao {
    public static int insertOrder(Connection conn, int custID, double totalPrice) throws SQLException {
        String sql = "INSERT INTO ORDERS (custID, totalPrice, orderDate, orderStatus) VALUES (?, ?, CURRENT_DATE, ?)";
        PreparedStatement ps = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
        ps.setInt(1, custID);
        ps.setDouble(2, totalPrice);
        ps.setString(3, "Pending");
        ps.executeUpdate();

        ResultSet rs = ps.getGeneratedKeys();
        return rs.next() ? rs.getInt(1) : -1;
    }

    public static void insertOrderItems(Connection conn, int orderID, int custID, JSONArray items) throws SQLException {
        String sql = "INSERT INTO ORDER_MERCH (custID, orderID, merchID, merchQty) VALUES (?, ?, ?, ?)";
        PreparedStatement ps = conn.prepareStatement(sql);
        for (int i = 0; i < items.length(); i++) {
            JSONObject item = items.getJSONObject(i);
            ps.setInt(1, custID);
            ps.setInt(2, orderID);
            ps.setInt(3, item.getInt("merchID"));
            ps.setInt(4, item.getInt("quantity"));
            ps.addBatch();
        }
        ps.executeBatch();
    }
}
